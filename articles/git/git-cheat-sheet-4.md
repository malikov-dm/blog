# Шпаргалка по использованию Git 4

## Отмена изменений (reset)

### Hard reset

Жесткий reset очищает и индекс и рабочую директорию, сдвигает указатели на вершину ветки и HEAD на указанный коммит:

```bash
git reset --hard <commit_id>            # сбрасывает рабочую директорию и индекс на указанный коммит
```

При жестком reset комиит не удаляется из базы, а просто указатели на вершину ветки и HEAD переносятся на указанный коммит.  
Если вдруг появилась необходимость отменить жесткий reset, можно воспользоваться командой

```bash
git reset --hard ORIG_HEAD              # ORIG_HEAD хранит идентификатор коммита, на котором находился указатель HEAD до его перемещения в последний раз
```

### Soft reset

Мягкий reset не трогает рабочую директорию и индекс, но сдвигает указатели на вершину ветки и HEAD на указанный коммит:

```bash
git reset --soft <commit_id>            #
```

Указатель ORIG_HEAD продолжает указывать на коммит, на который указывал HEAD до этого.

#### Пример использования soft reset

Кейс: был сделан коммит, в файлы которого не было внесено важное изменение. Чтобы неправильный коммит не остался в ветке, нужно применить soft reset:

Указатель вершины ветки и HEAD перемещены на один коммит назад `(@~)`:

```bash
git reset --soft "@~"                   #
```

При этом указатель ORIG_HEAD указывает на неправильный коммит.
В файлы проекта внесены соответствующие изменения, измененные файлы добавлены в индекс (`git add`).  
После этого необходимо закоммитить изменения:

```bash
git commit -c ORIG_HEAD                 # коммит с таким ключом возьмет описание из коммита, на который указывает ORIG_HEAD и откроет его на редактирование
git commit -С ORIG_HEAD                 # сделает коммит с описанием из коммита, на который указывает ORIG_HEAD
```

### Особый случай soft reset - изменение последнего коммита

Очень часто возникает необходимость исправить именно последний коммит.  
Для этого используется soft reset, вызываемый особым ключом команды `git commit` - это ключ `--amend`:

```bash
git commit --amend                      #
```

Эта команда эквивалентна двум командам git:

```bash
git reset --soft "@~"                   #
git commit -c ORIG_HEAD                 #
```

С ключом `--amend` можно использовать ключ `--reset-author`, который перезапишет автора, и ключ `--no-edit`, который не будет вызывать редактор для правки комментария.

```bash
git commit --amend -m "<comment_text>"  # правка комментария к коммиту прямо из командной строки
```

### Mixed reset

Смешанный reset не трогает рабочую директорию, но сбрасывает индекс и сдвигает указатели на вершину ветки и HEAD на указанный коммит:

```bash
git reset --mixed @~                    #
git reset @~                            # --mixed - режим reset по умолчанию
git reset HEAD                          # просто очистит индекс, если коммитить пока рановато
git reset                               # можно даже не указывать HEAD!
git reset <file_path>                   # сбрасывает указанный файл в индексе. Фактически, отменяет git add <file_path>
```

Также можно не только сбросить индекс, но и извлечь *в индекс* файл из какого-нибудь коммита:

```bash
git reset <commit_id> <file_path>       #
git checkout <commit_id> <file_path>    # а так файл будет извлечен не только в индекс, но и в рабочую директорию
```

### Reset с сохранением изменений

Reset с ключом `--keep` выполняет hard reset, но сохраняет незакоммиченные изменения в рабочей директории:

```bash
git reset --keep "@~"                   #
```

`--keep` работает только если файл не менялся в между коммитами. Если файл менялся - reset не сработает, вернет ошибку.

### Reset для отмены слияний

Reset с ключом `--merge` выполняет hard reset, сохраняет незакоммиченные изменения в рабочей директории, но если эти изменения были добавлены в индекс - сбрасывает файл к указанном коммиту и в индексе и в рабочей директории:

```bash
git reset --merge "@~"                  #
git reset --merge                       # HEAD можно не указывать
```

`--merge` выдаст ошибку, если в файле есть и проиндексированные и непроиндексированные изменения.

Данный вид reset применяется при конфликтах слияния.

### Документация

[Документацию по reset можно найти здесь](https://git-scm.com/docs/git-reset)

## Очистка проекта от изменений

### Через команды `git checkout` и `git reset`

Данные команды очистят рабочую директорию и индекс, но *не затронут неотслеживаемые файлы*:

```bash
git checkout -f                         # forced checkout HEAD
git reset --hard                        # hard reset
```

То есть, если файл был добавлен в проект, но не был добавлен в индекс - он не будет затронут этими командами.

### Через команду 'git clean'

Эта команда, наоборот, очистит *только неотслеживаемые* файлы и директории:

```bash
git clean                               #
git clean -dxf                          # -d - удалит не только неотслеживаемые файлы, но и неотслеживаеемые директории
                                        # -x - удалит в т.ч. файлы и директории, игнорируемые через файл .gitignore
                                        # -f - форсированное удаление
```

***

[< Работа с ветками](git-cheat-sheet-3.md) | [Просмотр (git diff) >](git-cheat-sheet-5.md)