# Шпаргалка по использованию Git 5

## Просмотр

### Просмотр изменений: git diff

```bash
git diff <branch_name1> <branch_name2>      # разница между коммитами, на которые указывают указатели
git diff <branch_name1>..<branch_name2>     # то же самое
git diff <branch_name1>...<branch_name2>    # что изменилось в ветке <branch_name2> с момента ответвления от ветки <branch_name1>
```

В качестве параметров команды можно указывать и другие указатели - идентификаторы коммитов, теги, HEAD и т.д.

Стоить отметить отличие двух команд:

```bash
git diff                                    # сравнивает рабочую директорию с индексом
git diff HEAD                               # сравнивает рабочую директорию с HEAD
```

`git diff` не сравнивает не отслеживаемые файлы.

Чтобы сравнить индекс с коммитом, используется ключ `--cached`:

```bash
git diff --cached <ref_1>                   # сравнивает индекс с коммитом
                                            # ref_1 - указатель на коммит
```

Есть еще один способ просмотреть изменения в файле - команда `git commit -v`.  
В этом случае откроется редактор для записи комментария к комиту, внизу которого будет приведена информация из `git diff --cached`, то есть различия индекса и HEAD.

Такое поведение можно включить и для `git commit` по умолчанию через конфиг:

```bash
git config --global commit.verbose true
```

или через алиас.

Сравнение файлов и директорий:

```bash
git diff <file_path1>                       # сравнение файла
git diff <dir_path1>                        # сравнение фиректории

```

#### Сравнение *нескольких* файлов

```bash
git diff <branch_name1> <branch_name2> -- <file_path1> <file_path2>
```

#### Сравнение *разных* файлов

Сравить два разных файла из двух разных коммитов:

```bash
git diff <ref_1>:<file_path_1> <ref_2>:<file_path_2>
```

Сравить два любых файла:

```bash
git diff --no-index <file_path_1> <file_path_2>
```

### Настройка сравнения: diff driver

Сравнение по словам:

```bash
git diff --word-diff                       #
git diff --word-diff=color                 # выделение diff полько цветом
git diff --color-words                     # то же самое
```

Под "словом" git понимает последовательность от пробела до пробела. Это создает трудности, например, при сравнении файлов *html*, поэтому для *html* файлов нужно использовать другой драйвер. выбор драйвера устанавливается в файле *.gitignore*.

```gitattributes
*.html diff=html
*.html diff=css
```

Свой драйвер можно добавить в конфиге через `[diff "<driver_name>"]`, `wordRegex`, `xfuncname` и пр., используя регулярные выражения *POSIX Extended*. [Подробнее.](https://git-scm.com/docs/gitattributes)

### Просмотр истории коммитов: git log

Команда `git log` выводит историю коммитов.

```bash
git log                                     # история коммитов, достижимых из HEAD
git log -p                                  # история с изменениями
git log <ref_1> <ref2> ...                  # история коммитов, достижимых из ref_1 или ref_2 или ...
git log <ref_1> <ref2> ... --graph          # выведет ветки истории псевдографикой
git log --all                               # выведет историю коммитов, достижимых из всех веток
git log <ref_1> ^<ref_2>                    # история коммитов, доступных из ref_1, но недоступных из ref_2
git log <ref_2>..<ref_1>                    # то же самое. Если одна из ссылок совпадает с HEAD, ее можно не указывать
git log ..<ref_1>                           # то же самое
git log <ref_1>..                           # или так
git log <ref_2>..<ref_1> --boundary         # добавит в вывод коммит, на котором произошло разделение
git log <ref_2>...<ref_1>                   # выведет коммиты, достижимые из ref_1 или ref_2, но не из них обоих
```

Наглядная демонстрация истории коммитов после разделения веток:

```bash
git log <ref_2>...<ref_1> --boundary --graph
```

Ключи для `git log`:

```bash
--pretty=oneline                            # история в одну строку  
--abbrev-commit                             # укороченный идентификатор коммита  
--oneline                                   # обе команды выше сразу  
--no-decodate                               # отключает декорирование  
--pretty=format: "<format_string>"          # отображает коммит в соответствии с format_string
```

 Вывод истории работает также для файлов, директорий и групп файлов

```bash
git log -p <file_path1>                     # выведет историю с изменениями для файла
git log -p --follow <file_path1>            # выведет историю если файл был переименован
git log <ref_2>..<ref_1> -- <file_path1>    # выведет историю файла в коммитах, доступных из ref_1 после отделения от ref_2
```

```bash
git log <ref_2>..<ref_1> -- <dir1> <dir2> <file_path2> <file_path1>
```

### Поиск в истории и фильтры: git log

```bash
git log --grep "<search_string>"            # поиск по комментариям к коммитам
git log -G"<regex>" -p                      # поиск по содержимому по perl-совместимому регулярному выражению
```

Поиск изменений в фрагменте файла, ограниченом двумя регулярными выражениями:

```bash
git log -L "<regex1>","<regex2>":<file_path1>
```

Поиск по телу функции, имя которой определено регулярным выражением:

```bash
git log -L :"<regex1>":<file_path1>
```

### Просмотр коммита, в котором была изменена та или иная строка файла: git blame

```bash
git blame <file_path1>                      #
```

В более читаемом виде:

```bash
git blame <file_path1> --date=short -L <start_line_number>,<end_line_mumber>
```

***

[< Отмена изменений (reset)](git-cheat-sheet-4.md) |